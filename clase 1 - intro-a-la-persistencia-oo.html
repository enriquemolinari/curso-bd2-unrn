<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Clase 1 - Introducción a la Persistencia Orientada a Objetos</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/agate.css">

		<link rel="stylesheet" href="css/font-4.5.0-awesome.min.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<style>
				section.pantallacompleta {
							 width: 100%;
							 height: 100%;
					 }
			 </style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Persistencia</h2>
					<h2>Orientada a Objetos</h2>
					<h4>Base de Datos 2</h4>
				</section>
				<section>
					<h2>¿Persistencia OO?</h2>
					<h3>¿De qué se trata?</h3>
				</section>
				<section>
					<h3>Uds ya cursaron...</h3>
					<ul>
						<li class="fragment"><strong>Orientación a Objetos 1 y 2</strong></li>
						<ul class="fragment"><li style="font-size: 32px">POO y Diseño OO</li></ul>
						<li class="fragment"><strong>Int. a las Bases de Datos 1, 2 y Bases de Datos 1</strong></li>
						<ul class="fragment"><li style="font-size: 32px">Modelo relacional: Diagramas ER, SQL, Normalización, Propiedades ACID</li></ul>
						<li class="fragment"><strong>Seminario de Lenguajes y Proyecto de Software</strong></li>
						<ul class="fragment"><li style="font-size: 32px">La plataforma Java, Sintaxis, Semántica, Colecciones, JDBC</li></ul>
					</ul>
				</section>
				<section>
					<h3>JDBC</h3>
					<pre><code class="java" code-trim data-noescape contenteditable style="font-size:18px">publc class Concurso {
	private String id;
	private String nombre;
	...
}
public void ejecutarInsert(Concurso concurso) {
  try (Connection conn = obtenerConexionBD();
    PreparedStatement statement = conn.prepareStatement("insert into
                              concurso(id, nombre) values ('ID1', ?)");) {
    statement.setString(1, concurso.nombre());
    statement.executeUpdate();
  } catch (SQLException ex) {
    throw new RuntimeException(ex);
  }
}</code></pre>
					<aside class="notes">De esta forma vemos los objetos como estructura de datos, obteniendo su estado interno via getters para generar sentencias SQL.
						Uno tiende a poner lógica de negocios en los métodos DAO de esta forma y no debería ser así.
					</aside>
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<p>¿No hay una forma mejor?</p>
					<blockquote class="fragment"><u>Transparencia</u>: El desarrollador tendría que preocuparse lo menos posible por la persistencia para centrarse en el modelo de objetos.</blockquote>
					<blockquote class="fragment"><u>Transparencia</u> == <u>Ortogonalidad</u> de la Persistencia.</blockquote>
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<p>¿A ver cómo se "implementa" la Transparencia?</p>
					<h4 class="fragment"><strong>Persistencia por Alcance</strong></h4>
					<ul>
						<li class="fragment">Objeto al cual se puede llegar a partir de un objeto ya persistente, debe ser necesariamente persistente.</li>
						<li class="fragment">Esto nos regala una forma elegante de diseñar, ya que para persistir un objeto solo tenemos que vincularlo a otro ya persistente.</li>
					</ul>
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<h4>Persistencia por Alcance</h4>
					<p class="fragment">Veamos...</p>
					<pre class="fragment"><code class="java" code-trim data-noescape contenteditable style="font-size:18px">public class Universidad {
  private Set&lt;Concurso> cs = new HashSet&lt;>();
  public void nuevoConcurso(Concurso c) {
    cs.add(c);
  }
  ...
}
<span class="fragment">public void nuevoConcurso(String nombreConcurso) {</span>
<span class="fragment">  Concurso c = new Concurso(nombreConcurso);</span>
<span class="fragment">  Universidad unrn = //contexto.recuperar(...) unrn de la base de datos</span>
<span class="fragment">  unrn.nuevoConcurso(c);</span>
<span class="fragment">}</span></code></pre>
					<aside class="notes">Notar que hacer la instancia de Concurso c persistente es totalmente transparente. No es tan transparente el traer de la BD a unrn.<aside>
				</section>
				<section data-background="imgs/shock-face-o.gif">
				</section>
				<section data-transition="slide" data-background="#b5533c" data-background-transition="zoom">
					<h3>Persistencia Orientada a Objetos</h3>
					<h4>¿Qué más tenemos que saber?</h4>
					<p class="fragment"><i>Ciclo de Vida de los Objetos Persistentes</i></p>
				</section>
				<section>
					<h3>Ciclo de Vida de los Objetos Persistentes</h3>
					<p class="fragment">¿Cual es el ciclo de vida de los Objetos? (olvidemos la persistencia por un ratito)</p>
					<p class="fragment"><strong>new</strong>: Se crea la instancia y se aloja en memoria</p>
					<p class="fragment"><strong>delete</strong>: El Garbage Colector se encarga</p>
					<blockquote class="fragment">Al incorporar persistencia se agregan nuevos estados.</blockquote>
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<p>Ciclo de Vida de los Objetos Persistentes</p>
					<img src="imgs/entity-states.png" class="plain">
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<p>¿Quién lleva registro en memoria del estado de los objetos persistentes?</p>
					<h4 class="fragment"><strong>Contexto de Persistencia</strong></h4>
					<ul>
						<li class="fragment">Maneja y monitorea en memoria todas las instancias de las clases persistentes.</li>
						<li class="fragment">Reconoce cuando una instancia fue modificada para persistirla.</li>
						<li class="fragment">Básicamente... es quien se encarga de la magia!</li>
					</ul>
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<p>Veamos un ejemplo en JPA (Java Persistent API)</p>
					<pre><code class="java" code-trim data-noescape contenteditable style="font-size:18px">public void nuevoConcurso(String nombreConcurso) {
 <span class="fragment" data-fragment-index="1">EntityManager <span class="fragment highlight-blue" data-fragment-index="6">manager</span> = EntityManagerFactory.createEntityManager();</span>
 <span class="fragment"  data-fragment-index="2">Concurso concurso = new Concurso(nombreConcurso);</span>
 <span class="fragment" data-fragment-index="3">Universidad unrn = <span class="fragment highlight-blue" data-fragment-index="6">manager</span>.find(idUnrn);</span>
 <span class="fragment" data-fragment-index="4">unrn.nuevoConcurso(concurso);</span>
 <span class="fragment" data-fragment-index="5"><span class="fragment highlight-blue" data-fragment-index="6">manager</span>.close();</span><span class="fragment" data-fragment-index="7"> //Aca se persiste lo modificado...</span>
}</code></pre>
				<p class="fragment">¿Cuál es el estado de <i>unrn</i> y <i>concurso</i>?</p>
				<p class="fragment">¿Queda <i>unrn</i> en estado <u>detached</u>?</p>
				</section>
				<section data-transition="slide" data-background="#b5533c" data-background-transition="zoom">
					<h3>Persistencia Orientada a Objetos</h3>
					<h4>¿Y qué más tenemos que saber?</h4>
					<p class="fragment"><i>Cascade</i> & <i>Lazy</i> vs <i>Early</i></p>
				</section>
				<section>
					<h3>Persistencia Orientada a Objetos</h3>
					<p>Cascade</p>
					<pre><code class="java" code-trim data-noescape contenteditable style="font-size:18px">public void nuevoProducto() {
 <span>EntityManager manager = EntityManagerFactory.createEntityManager();</span>
 <span class="fragment"  data-fragment-index="2">Categoria elec = new Categoria("electrodoméstico");</span>
 <span class="fragment"  data-fragment-index="2">Producto tv = new Producto("TV", elec);</span>
 <span class="fragment" data-fragment-index="3"><span class="fragment strike" data-fragment-index="6">manager.persist(elec);</span></span>
 <span class="fragment" data-fragment-index="4">manager.persist(tv);</span>
 <span>manager.close();</span>
}</code></pre>
				<p class="fragment" data-fragment-index="5">¿Podría solamente persistir el producto y que se persista su categoria mágicamente?</p>
				<p class="fragment">Sí. Debería configurar los colaboradores de <i>Producto</i> como <i>cascade</i> = true</p>
				</section>
				<section>
    			 <h2>Early vs Lazy</h2>
					 <p class="fragment">Supongamos el siguiente modelo:</p>
					 <pre class="fragment"><code class="java" code-trim data-noescape contenteditable style="font-size:18px">public class Universidad {
 private Set&lt;Concurso> concursos = new HashSet&lt;Concurso>();
 private Categoria categoria;
 private String domicilio;
 public void nuevoConcurso(Concurso c) {
  cs.add(c);
 }
 ...
}
public class Concurso {
 private List&lt;Persona> inscriptos = new ArrayList&lt;>();
 ...
 ...
}</pre></code>
				</section>
				<section>
    			 <h2>Early vs Lazy</h2>
					 <p class="fragment">Segun el modelo anterior, si traemos de la BD la instancia <i>unrn</i>:</p>
					 <pre class="fragment"><code class="java" code-trim data-noescape contenteditable style="font-size:18px">...
EntityManager manager = EntityManagerFactory.createEntityManager();
Universidad unrn = manager.find(idUnrn);
manager.close();
...</pre></code>
					<p class="fragment">¿Qué trae a memoria junto con <i>unrn</i>? ¿su instancia de categoria? ¿sus concursos?</p>
				</section>
				<section data-background-size="40%" data-background-image="imgs/modelo.jpg" class="fig-container pantallacompleta"
					data-fig-id="fig-collision-detection"
					data-file="_diagram_earlygraph.html">
					<h2>Early vs Lazy</h2>
					<aside class="notes">Ir mostrando de a poco el grafo de objetos para ir preguntandole a los alumnos hasta donde se trae...</aside>
				</section>
				<section data-background-image="imgs/bomb.jpg"></section>
				<section data-background-size="40%" data-background-image="imgs/oome.png"></section>
				<section>
					<h2>Early vs Lazy</h2>
					<p class="fragment"><u>Por colaborador</u> se configura si deseo <i>early</i> o <i>lazy</i></p>
					<p class="fragment"><b>Early</b> (temprano): Al recuperar una instancia, recupero su colaborador también.</p>
					<p class="fragment"><b>Lazy</b> (tardío): Al recuperar una instancia, inyecta en su colaborador un <u>Proxy</u>, quién sabe recuperar el <u>colaborador real</u> solo cuando sea necesario.</p>
					<blockquote class="fragment">¿Cuando se vuelve necesario?</blockquote>
				</section>
				<section>
					<h2>Lazy</h2>
					<p>¿Cuándo se dispara la recuperación de la BD del colaborador?</p>
					<pre>
						<code class="java" code-trim data-noescape contenteditable style="font-size:18px">public class Universidad {
  private Set&lt;Concurso> concursos = new HashSet&lt;Concurso>();
  private Categoria categoria;
  private String domicilio;
  public void nuevoConcurso(Concurso c) {
   cs.add(c);
  }
  /*...Demostrar cuando se dispara...*/
 }
public class Concurso {
  private List&lt;Personas> inscriptos = new ArrayList&lt;>();
  ...
  ...
}</code></pre>
				</section>
        <section>
					<h3>Bibliografía</h3>
					<ul>
						<li>Persistencia Orientada a Objetos (Javier Bazzocco, EDULP, 2012)</li>
						<li>Java Persistence with Hibernate (Second Edition. Gaving King, 2015)</li>
						<li>Next Generation Databases: NoSQL, NewSQL, and Big  Data (Guy Harrison, 2015)</li>
            <li>ODBMS <a href="http://www.odbms.org/free-downloads-and-links/object-databases/">Object Databases</a>. Papers en línea.</li>
					</ul>
				</section>
				</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				transition: 'slide', // none/fade/slide/convex/concave/zoom
				dependencies: [
					{ src: 'js/d3.v3.min.js'},
					{ src: 'plugin/chalkboard/chalkboard.js' },
					{ src: 'node_modules/reveal.js-d3js/d3js.js' },
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				],
				chalkboard: {
					toggleChalkboardButton: { left: "80px" },
					toggleNotesButton: { left: "130px" },
				},
				keyboard: {
			    67: function() { RevealChalkboard.toggleNotesCanvas() },	// toggle notes canvas when 'c' is pressed
			    66: function() { RevealChalkboard.toggleChalkboard() },	// toggle chalkboard when 'b' is pressed
			    46: function() { RevealChalkboard.clear() },	// clear chalkboard when 'DEL' is pressed
			     8: function() { RevealChalkboard.reset() },	// reset chalkboard data on current slide when 'BACKSPACE' is pressed
			    68: function() { RevealChalkboard.download() },	// downlad recorded chalkboard drawing when 'd' is pressed
				},
			});
		</script>
	</body>
</html>
